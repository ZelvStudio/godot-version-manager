#!/bin/bash

echo '#!/bin/bash

# run tests
pytest -v

# automatically change gdvm version

TAG=$(git describe --tags)

BRANCH=$(git branch --show-current)
case $BRANCH in
	main)
		VERSION=${TAG};;
	*)
		VERSION="${TAG}:${BRANCH}";;
esac

echo "# DO NOT EDIT: automatically generated by git pre-commit hook

VERSION = \"${VERSION}\"" > gdvm/version.py

git add gdvm/version.py

echo VERSION: bumping to ${VERSION}
' > .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
